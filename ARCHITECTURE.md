# Redis_JWT ì‹œìŠ¤í…œ ì•„í‚¤í…ì³ ì„¤ê³„ë„

## ğŸ“‹ ì‹œìŠ¤í…œ ê°œìš”
Redisë¥¼ í™œìš©í•œ ì„¸ì…˜ ê´€ë¦¬ì™€ JWT í† í° ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œ

## ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client App    â”‚    â”‚   Load Balancer â”‚    â”‚   API Gateway   â”‚
â”‚  (Web/Mobile)   â”‚â—„â”€â”€â–ºâ”‚    (Nginx)      â”‚â—„â”€â”€â–ºâ”‚   (Optional)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Application                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Auth      â”‚  â”‚   Posts     â”‚  â”‚   Users     â”‚            â”‚
â”‚  â”‚  Service    â”‚  â”‚  Service    â”‚  â”‚  Service    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ JWT Manager â”‚  â”‚ Redis Cache â”‚  â”‚ Middleware  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis Cache   â”‚    â”‚   SQLite DB     â”‚
â”‚  (Session/JWT)  â”‚    â”‚  (User Data)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. ì¸ì¦ ì‹œìŠ¤í…œ (Authentication Layer)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            JWT + Redis ì¸ì¦              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ JWT Token   â”‚  â”‚ Redis Session   â”‚   â”‚
â”‚  â”‚ Generator   â”‚  â”‚    Manager      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Token       â”‚  â”‚ Refresh Token   â”‚   â”‚
â”‚  â”‚ Validator   â”‚  â”‚    Handler      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ë°ì´í„° í”Œë¡œìš°
```
Client Request
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Middleware  â”‚ â”€â”€â–º JWT í† í° ê²€ì¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Check â”‚ â”€â”€â–º ì„¸ì…˜ ìœ íš¨ì„± í™•ì¸
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Route       â”‚ â”€â”€â–º ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
â”‚ Handler     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database    â”‚ â”€â”€â–º ë°ì´í„° CRUD
â”‚ Operation   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ê³„

```
Redis_JWT/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt_handler.py      # JWT í† í° ìƒì„±/ê²€ì¦
â”‚   â”‚   â”‚   â”œâ”€â”€ dependencies.py     # ì¸ì¦ ì˜ì¡´ì„±
â”‚   â”‚   â”‚   â””â”€â”€ routes.py          # ì¸ì¦ ë¼ìš°íŠ¸
â”‚   â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ redis_client.py    # Redis ì—°ê²° ê´€ë¦¬
â”‚   â”‚   â”‚   â””â”€â”€ session_manager.py # ì„¸ì…˜ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py           # ì‚¬ìš©ì ëª¨ë¸
â”‚   â”‚   â”‚   â””â”€â”€ post.py           # ê²Œì‹œê¸€ ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py           # ì¸ì¦ API
â”‚   â”‚   â”‚   â”œâ”€â”€ users.py          # ì‚¬ìš©ì API
â”‚   â”‚   â”‚   â””â”€â”€ posts.py          # ê²Œì‹œê¸€ API
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ auth_middleware.py # ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ settings.py       # ì„¤ì • ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ database.py           # DB ì—°ê²°
â”‚   â””â”€â”€ main.py                   # FastAPI ì•± ì§„ì…ì 
â”œâ”€â”€ tests/                        # í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”œâ”€â”€ docker-compose.yml           # Redis ì»¨í…Œì´ë„ˆ
â”œâ”€â”€ requirements.txt             # ì˜ì¡´ì„±
â””â”€â”€ README.md
```

## ğŸ” ë³´ì•ˆ ì•„í‚¤í…ì³

### JWT í† í° ì „ëµ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              JWT Strategy                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Access Token (15ë¶„)                    â”‚
â”‚  â”œâ”€ ì§§ì€ ë§Œë£Œì‹œê°„                        â”‚
â”‚  â”œâ”€ API ìš”ì²­ ì¸ì¦ìš©                      â”‚
â”‚  â””â”€ Redisì— ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬              â”‚
â”‚                                         â”‚
â”‚  Refresh Token (7ì¼)                    â”‚
â”‚  â”œâ”€ ê¸´ ë§Œë£Œì‹œê°„                         â”‚
â”‚  â”œâ”€ Access Token ê°±ì‹ ìš©                 â”‚
â”‚  â””â”€ Redisì— ì €ì¥ ë° ê´€ë¦¬                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Redis ì„¸ì…˜ ê´€ë¦¬
```
Redis Key Structure:
â”œâ”€ session:{user_id}        # ì‚¬ìš©ì ì„¸ì…˜ ì •ë³´
â”œâ”€ refresh:{token_id}       # Refresh Token ì €ì¥
â”œâ”€ blacklist:{token_id}     # ë¸”ë™ë¦¬ìŠ¤íŠ¸ í† í°
â””â”€ rate_limit:{user_id}     # API ìš”ì²­ ì œí•œ
```

## ğŸš€ API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„

### ì¸ì¦ API
- `POST /auth/register` - íšŒì›ê°€ì…
- `POST /auth/login` - ë¡œê·¸ì¸
- `POST /auth/refresh` - í† í° ê°±ì‹ 
- `POST /auth/logout` - ë¡œê·¸ì•„ì›ƒ
- `GET /auth/me` - ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

### ê²Œì‹œê¸€ API
- `GET /posts` - ê²Œì‹œê¸€ ëª©ë¡ (ì¸ì¦ í•„ìš”)
- `POST /posts` - ê²Œì‹œê¸€ ì‘ì„± (ì¸ì¦ í•„ìš”)
- `GET /posts/{id}` - ê²Œì‹œê¸€ ìƒì„¸ (ì¸ì¦ í•„ìš”)
- `PUT /posts/{id}` - ê²Œì‹œê¸€ ìˆ˜ì • (ì¸ì¦ í•„ìš”)
- `DELETE /posts/{id}` - ê²Œì‹œê¸€ ì‚­ì œ (ì¸ì¦ í•„ìš”)

## ğŸ“Š ì„±ëŠ¥ ìµœì í™” ì „ëµ

### ìºì‹± ì „ëµ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Redis ìºì‹± ì „ëµ               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L1: ì„¸ì…˜ ë°ì´í„° (TTL: 30ë¶„)            â”‚
â”‚  L2: ì‚¬ìš©ì ì •ë³´ (TTL: 1ì‹œê°„)           â”‚
â”‚  L3: ê²Œì‹œê¸€ ëª©ë¡ (TTL: 5ë¶„)             â”‚
â”‚  L4: API ì‘ë‹µ ìºì‹œ (TTL: 1ë¶„)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
- ì¸ë±ìŠ¤ ì„¤ê³„: user_id, created_at
- ì—°ê²° í’€ë§: SQLAlchemy ì—°ê²° ê´€ë¦¬
- ì¿¼ë¦¬ ìµœì í™”: N+1 ë¬¸ì œ ë°©ì§€

## ğŸ”„ ë°°í¬ ì•„í‚¤í…ì³

### ê°œë°œ í™˜ê²½
```
Developer Machine
â”œâ”€ FastAPI (uvicorn)
â”œâ”€ Redis (Docker)
â””â”€ SQLite (ë¡œì»¬ íŒŒì¼)
```

### í”„ë¡œë•ì…˜ í™˜ê²½
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load Balancer â”‚    â”‚   FastAPI App   â”‚
â”‚     (Nginx)     â”‚â—„â”€â”€â–ºâ”‚   (Gunicorn)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Cluster  â”‚    â”‚  PostgreSQL     â”‚
â”‚   (HA Setup)    â”‚    â”‚   (Primary)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ë¡œê·¸ êµ¬ì¡°
```
Application Logs
â”œâ”€ auth.log          # ì¸ì¦ ê´€ë ¨ ë¡œê·¸
â”œâ”€ api.log           # API ìš”ì²­/ì‘ë‹µ ë¡œê·¸
â”œâ”€ error.log         # ì—ëŸ¬ ë¡œê·¸
â””â”€ performance.log   # ì„±ëŠ¥ ë©”íŠ¸ë¦­
```

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- Redis ì—°ê²° ìƒíƒœ
- JWT í† í° ë°œê¸‰/ê²€ì¦ íšŸìˆ˜
- API ì‘ë‹µ ì‹œê°„
- ì—ëŸ¬ìœ¨ ë° ì„±ê³µë¥ 

## ğŸ›¡ï¸ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **CORS ì„¤ì •**: í—ˆìš©ëœ ë„ë©”ì¸ë§Œ ì ‘ê·¼
2. **Rate Limiting**: Redis ê¸°ë°˜ ìš”ì²­ ì œí•œ
3. **Input Validation**: Pydantic ëª¨ë¸ ê²€ì¦
4. **SQL Injection ë°©ì§€**: SQLAlchemy ORM ì‚¬ìš©
5. **XSS ë°©ì§€**: ì…ë ¥ ë°ì´í„° sanitization
6. **HTTPS ê°•ì œ**: í”„ë¡œë•ì…˜ í™˜ê²½ SSL/TLS

ì´ ì•„í‚¤í…ì³ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¨ê³„ë³„ êµ¬í˜„ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?